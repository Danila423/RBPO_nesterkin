# BDD — Приёмочные сценарии для Security NFR

## Feature: Argon2id хеширование паролей

Scenario: Проверка безопасности хеширования паролей
  Given пользователь регистрируется через /auth/register
  When пароль сохраняется в базе данных
  Then password_hash должен быть Argon2id с параметрами t=3, m=65536, p=4

Scenario: Негативный - использование устаревшего алгоритма
  Given разработчик пытается изменить алгоритм хеширования на SHA256
  When система проверяет конфигурацию безопасности
  Then build CI должен завершиться с ошибкой "unsupported hashing scheme"

---

## Feature: TTL токена (≤ 15 минут)

Scenario: Проверка срока жизни access-токена
  Given пользователь логинится через /auth/login
  When access_token декодируется
  Then exp - iat ≤ 900 секунд

Scenario: Негативный - истёкший токен
  Given access_token старше 15 минут
  When пользователь делает запрос к /wishes
  Then сервер возвращает 401 Unauthorized

---

## Feature: Логирование критичных действий

Scenario: Создание или удаление Wish фиксируется в аудит-логе
  Given пользователь создаёт Wish через /wishes
  When действие успешно выполняется
  Then в логах появляется запись с action=create и user_id текущего пользователя

---

## Feature: Ротация секретов

Scenario: Проверка политики ротации секретов
  Given сервис использует API-ключ старше 90 дней
  When выполняется сканирование secrets
  Then CI отчёт должен помечать ключ как устаревший

---

## Feature: Маскирование персональных данных

Scenario: Проверка отсутствия PII в логах
  Given приложение обрабатывает POST /auth/login
  When включено логирование запросов
  Then в логе не должно быть email, токенов или паролей

---
